version: '3.8' # Используем современную версию Compose

services:
  lru-cache-api:
    build:
      context: . # Указывает Docker собирать образ из текущей директории (где лежит Dockerfile)
      dockerfile: Dockerfile
    container_name: lru_cache_api_service # Имя контейнера для удобства
    ports:
      # Маппинг порта: <порт_на_хосте>:<порт_в_контейнере>
      # Запросы на localhost:8000 будут перенаправлены на порт 8000 контейнера
      - "8000:8000"
    environment:
      # Передаем переменную окружения CACHE_CAPACITY в контейнер
      # Можно задать значение здесь или использовать .env файл (см. ниже)
      - CACHE_CAPACITY=100 # Пример: емкость кэша 100
      # Можно также указать, чтобы Compose загружал переменные из .env файла
    # env_file:
    #   - .env
    volumes:
       # Опционально: монтирование кода для разработки (для production лучше убрать)
       # Позволяет видеть изменения кода в контейнере без пересборки образа
       # (требует uvicorn с --reload в CMD Dockerfile)
       # - .:/app # Монтируем текущую директорию хоста в /app контейнера
    # Добавим healthcheck (опционально, но полезно)
    healthcheck:
        test: ["CMD", "curl", "-f", "http://localhost:8000/"] # Проверяем корневой эндпоинт
        interval: 30s # Проверять каждые 30 секунд
        timeout: 10s # Таймаут проверки 10 секунд
        retries: 3 # 3 попытки перед тем, как считать сервис нездоровым
        start_period: 10s # Дать контейнеру 10 секунд на запуск перед первой проверкой