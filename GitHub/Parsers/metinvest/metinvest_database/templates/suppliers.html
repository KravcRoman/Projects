{% load static %}<!DOCTYPE html><!-- saved from url=(0022)https://prod.pkf-m.ru/ -->
<html lang="en">
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <link rel="stylesheet" href="{% static 'lk_files/fontawesome.min.css' %}">
 <link rel="stylesheet" href="{% static 'lk_files/reset.css' %}">
 <link rel="stylesheet" href="{% static 'lk_files/fonts.css' %}">
 <link rel="stylesheet" href="{% static 'lk_files/header.css' %}">
 <link rel="stylesheet" href="{% static 'lk_files/delivery.css' %}">
 <link rel="stylesheet" href="{% static 'lk_files/positions.css' %}">
 <link rel="stylesheet" href="{% static 'lk_files/total.css' %}">
 <link rel="stylesheet" href="{% static 'lk_files/media.css' %}">
 <link rel="stylesheet" href="{% static 'lk_files/style.css' %}">
 <title>Личный кабинет</title>
 <link href="{% static 'lk_files/bootstrap.min.css' %}" rel="stylesheet">
 <link href="{% static 'lk_files/dashboard.css' %}" rel="stylesheet">
 <link rel="stylesheet" href="{% static 'lk_files/bootstrap-icons.css' %}">
 <title>Ваша страница</title>
 <style>
        .empty-table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }


        .empty-table th {
            background-color: #f2f2f2;
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }


        .empty-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
           #results-container {

  display: flex;
}
        #product-results
        {
      position: absolute;

      left: 50%;
      background-color: white;

      max-height: 200px;
     /*overflow-y: auto; */
      width: 50%;
      flex: 1;
  padding: 10px;
  border: 1px solid #ccc;
  box-sizing: border-box;
}
    #category-results {
      position: absolute;


      left: 0;
      background-color: white;

      max-height: 200px;
      /*overflow-y: auto; */
      width: 50%;
      flex: 1;
  padding: 10px;
  border: 1px solid #ccc;
  box-sizing: border-box;
}
.result {
  cursor: pointer;
  transition: background-color 0.2s, color 0.2s;
  padding: 10px;
}

.result:hover {
  background-color: #007bff;
  color: white;
}

.hover_price:hover {
  background-color: #aaffaa;
}

 </style>
</head>

<body>
<header class="header">
 <div class="header__top">
  <div class="container">
   <div class="header__top-inner">
    <div class="header__logo">
     <a href="https://prod.pkf-m.ru/#"> <img class="logo" src="{% static 'lk_files/logo.svg' %}" alt=""> </a>
    </div>
    <div class="header__contacts">
     <address>
      <div class="address__item">
       <img class="address__item-icon" src="{% static 'lk_files/icon-clock.svg' %}" alt="">
       <div class="address__item-text">
        <a href="https://prod.pkf-m.ru/">Круглосуточная поддержка</a>
       </div>
      </div>
      <div class="address__item">
       <img class="address__item-icon" src="{% static 'lk_files/icon-phone.svg' %}" alt="">
       <div class="address__item-text">
        <a href="tel:+78006003327">8 800 600-33-27</a>
       </div>
      </div>
      <div class="address__item">
       <img class="address__item-icon" src="{% static 'lk_files/icon-mail.svg' %}" alt="">
       <div class="address__item-text">
        <a href="mailto:">info@pkf-m.ru</a>
       </div>
      </div>
     </address>
    </div>
    <div class="header__user">
     <img class="header__user-img" src="{% static 'lk_files/user.svg' %}" alt=""> <img class="arrow-down" src="{% static 'lk_files/arrow-down.svg' %}" alt="">
    </div>
   </div>
  </div>
 </div>
 <nav class="nav">
  <div class="container">
   <div class="nav__inner">
    <ul class="nav__list">
     <a class="nav__item-link" href="/">
      <li class="nav__item">Расчет стоимости</li>
     </a> <a class="nav__item-link" href="https://prod.pkf-m.ru/">
     <a class="nav__item-link" href="/create-supplier">
      <li class="nav__item">Поставщики</li>
     </a> <a class="nav__item-link" href="https://prod.pkf-m.ru/">
     <li class="nav__item">История</li>
    </a>
    </ul>
   </div>
  </div>
 </nav>
</header>

<div class="delivery" style="background-color: #eeeeee; margin-bottom: 40px">

<!-- <div class="container">-->
<!--  <div class="delivery__inner">-->
<!--   <div class="delivery__item">-->
<!--    <p class="delivery__title title">metinvest. <span >Введите адрес доставки</span></p>-->
<!--   </div>-->
<!--  </div>-->
<!-- </div>-->

<!-- <div class="navbar sticky-top flex-md-nowrap p-0 shadow delivery__select-wrapper">-->
<!--  <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" style="color: black; text-align: right" href="/">Место назначения:</a>-->
<!--  <input-->
<!--    class="form-control w-100" type="text" id="address-input" placeholder="Адрес" aria-label="Search" autocomplete="off">-->
<!-- </div>-->

<!-- <div class="navbar sticky-top flex-md-nowrap p-0 shadow delivery__select-wrapper">-->
<!--    <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" style="color: black; text-align: right" href="/">Регион поиска товара:</a>-->
<!--    <div class="region__select-wrapper" style="width: 100%; ">-->
<!--     <select class="region__select" name="" style="border: 0px; background: none; font-size: 1rem">-->
<!--      <option class="region__select-item" value="" selected="">Ближайший по адресу доставки</option>-->
<!--      <option class="region__select-item" value="">Москва</option>-->
<!--      <option class="region__select-item" value="">Санкт-Петербург</option>-->
<!--      <option class="region__select-item" value="">Владивосток</option>-->
<!--     </select>-->
<!--    </div>-->
<!--   </div>-->

<!--</div>-->

<!--<hr>-->

<div class="positions__header" style="background-color: #eeeeee">
 <div class="container">
  <div class="positions__header-inner">
   <p class="positions__title title">1. <span >Добавьте позиции</span></p>
   <!--              <div class="buttons">-->
   <!--                <a class="btn" href="">-->
   <!--                  <img class="btn-icon" src="/static/images/positions/download.svg" alt="">-->
   <!--                  <span class="btn-text">Скачать расчет</span>-->
   <!--                </a>-->
   <!--                <a class="btn" href="">-->
   <!--                  <img class="btn-icon" src="/static/images/positions/print.svg" alt="">-->
   <!--                  <span class="btn-text">Распечатать</span>-->
   <!--                </a>-->
   <!--              </div>-->
  </div>
 </div>
</div>

<form method="post" action="/">
 <div class="navbar sticky-top flex-md-nowrap p-0 shadow">
  <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" style="color: black; text-align: right" href="/">Введите наименование:</a> <input
    class="form-control w-100" type="text" id="search-input" placeholder="Поиск" aria-label="Search" autocomplete="off">
  <button class="btn btn-primary" id="search-button" style="margin-left: 40px; display: none">Поиск</button>
  <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu"
          aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
   <span class="navbar-toggler-icon"></span>
  </button>
 </div>
</form>

<!--<div id="results-container" style="display:none" class="search-data">-->
<!-- <div id="category-results"></div>-->
<!-- <div id="product-results"></div>-->
<!--</div>-->

<div>
 <div style="text-align: center; display: none; font-size: 24px; margin-top: 25px" class="search-data">Товары</div>
 <table id="products_table" class="products__table empty-table search-data" style="display:none">
 <thead>
 <tr class="table__first-tr">
  <th class="products__table-th">Категория</th>
  <th class="products__table-th">Наименование</th>
  <th class="products__table-th">Характеристики</th>
  <th class="products__table-th">Город</th>
  <th class="products__table-th">Поставщик</th>
  <th class="products__table-th">Цена</th>
 </tr>
 </thead>
 <tbody></tbody>
</table>


<div style="text-align: center; display: none; font-size: 24px; margin-top: 25px" class="search-data">Категории</div>
<table id="categories_table" class="products__table empty-table search-data" style="display:none">
 <thead>
 <tr class="table__first-tr">
  <th class="products__table-th">Наименование</th>
 </tr>
 </thead>
 <tbody></tbody>
</table>
</div>

<div class="pagination search-data" style="text-align: center; margin-top: 25px; margin-bottom: 40px; display: none; margin-left: 40%">
 <button id="prev-page" style="margin-right: 17px">Предыдущая страница</button>
 <span id="current-page">Страница 1</span>
 <button id="next-page" style="margin-left: 17px">Следующая страница</button>
</div>

<div class="empty-caption not-search-data" style="text-align: center; margin-top: 25px; margin-bottom: 25px">
 <span>Здесь появятся найденные товары</span>
</div>

<!--</div>-->
<!--        <label for="limit">Limit:</label>-->
<!--<input type="number" id="limit" value="10">-->
<!--<br>-->
<!--<label for="offset">Offset:</label>-->
<!--<input type="number" id="offset" value="0">-->
<hr>

<div class="positions__header" style="background-color: #eeeeee; margin-top: 40px">
 <div class="container">
  <div class="positions__header-inner">
   <p class="positions__title title">2. <span >
               Отредактируйте позиции или добавьте новые</span></p>
<!--   <div class="buttons">-->
<!--    <a class="btn" href=""> <img class="btn-icon" src="/static/images/positions/download.svg" alt=""> <span class="btn-text">Скачать расчет</span> </a> <a-->
<!--      class="btn" href=""> <img class="btn-icon" src="/static/images/positions/print.svg" alt=""> <span class="btn-text">Распечатать</span> </a>-->
<!--   </div>-->
  </div>
 </div>
</div>
<table id="selected_products" style="margin-bottom: 40px" class="empty-table">
 <tr>
  <th>Позиция</th>
  <th>Цена</th>
  <th>Кол-во</th>
  <th>Ед</th>
  <th>Сумма</th>
  <th>Примечание</th>
  <th>X</th>
 </tr>
 <tr>
  <td><input id="new_position" type="text" placeholder="Новая позиция"/></td>
  <td><input id="new_price" type="text" placeholder="Стоимость"/></td>
  <td><!--<input id="new_q" type="text" placeholder="Кол-во"/>--></td>
  <td><!--<input id="new_units" type="text" placeholder="Ед."/>--></td>
  <td></td>
  <td><input style="width: 100%" type="text" placeholder="Комментарий"/></td>
  <td>
   <span style="color: black; cursor: pointer; border: 1px black solid; background-color: #ffffff; padding: 3px" class="delete-text"
         onclick="addSelectedProduct($('#new_position').val(), $('#new_price').val()); $('#new_position').val(''); $('#new_price').val('')">
    Добавить в таблицу
   </span>
  </td>
 </tr>
</table>
<!--<div style="margin-bottom: 40px">
 <div class="adding">
  <div class="adding__name">
   <div class="adding__name-value">Лист горячекатаный 2 мм ст20 1250х2500</div>
   <div class="adding__name-input">
    <input class="adding__input" type="text"> <span>тн</span>
   </div>
  </div>
  <div class="adding__features">
   <div class="adding__features-link"><a href="https://prod.pkf-m.ru/#">+ Комментарий</a></div>
   <div class="adding__features-link"><a href="https://prod.pkf-m.ru/#">+ Добавить услугу</a></div>
  </div>
  <div class="adding__btns">
   <div class="adding__btns-plus">
    <a href="https://prod.pkf-m.ru/#"> <img class="plus-icon" src="lk_files/plus-circle.svg" alt=""> <span class="plus-text">Добавить в таблицу</span> </a>
   </div>
   <div class="adding__btns-delete">
    <a href="https://prod.pkf-m.ru/#"> <img class="delete-icon" src="{% static 'lk_files/delete.svg' %}" alt=""> <span class="delete-text">Удалить</span> </a>
   </div>
  </div>
 </div>
 <div class="positions__total">
  <div class="selecting__good">
   <a class="selecting__good-wrapper" href="https://prod.pkf-m.ru/#"> <img src="{% static 'lk_files/select.svg' %}" alt=""> <span>Выбрать товар</span> </a>
  </div>
  <div class="positions__sum-items">
   <div class="positions__sum-item">
    <span class="positions__sum-name">Итого:</span> <span class="positions__sum-value">..... 2 078 731,00</span>
   </div>
   <div class="positions__sum-item">
    <span class="positions__sum-name">В том числе НДС:</span> <span class="positions__sum-value">..... 346 455,16</span>
   </div>
   <div class="positions__sum-item">
    <span class="positions__sum-name">Всего к оплате:</span> <span class="positions__sum-value">..... 2 078 731,00</span>
   </div>
  </div>
 </div>
 <div class="bottom-btns">
  <a class="draft-btn">В черновики</a> <a class="count-btn">Выписать счёт</a>
 </div>
</div>-->

<hr>

<div class="positions__header" style="background-color: #eeeeee; margin-top: 40px">
 <div class="container">
  <div class="positions__header-inner">
   <p class="positions__title title">3. <span >
               Ознакомьтесь с предварительным расчетом</span>
    <!--              <div class="buttons">-->
    <!--                <a class="btn" href="">-->
    <!--                  <img class="btn-icon" src="/static/images/positions/download.svg" alt="">-->
    <!--                  <span class="btn-text">Скачать расчет</span>-->
    <!--                </a>-->
    <!--                <a class="btn" href="">-->
    <!--                  <img class="btn-icon" src="/static/images/positions/print.svg" alt="">-->
    <!--                  <span class="btn-text">Распечатать</span>-->
    <!--                </a>-->
    <!--              </div>-->
  </div>
 </div>
</div>
<div class="calculation" style="margin-bottom: 40px">
 <div class="container">
  <div class="calculation__header">
   <div class="buttons calculation__buttons">
    <a class="btn" href="https://prod.pkf-m.ru/"> <img class="btn-icon" src="{% static 'lk_files/download.svg' %}" alt=""> <span
       class="btn-text">Скачать расчет</span> </a> <a class="btn" href="https://prod.pkf-m.ru/"> <img class="btn-icon" src="{% static 'lk_files/print.svg' %}"
                                                                                                      alt=""> <span class="btn-text">Распечатать</span> </a>
   </div>
  </div>
  <div class="total">
   <div class="total__header">
    <img class="total__img" src="{% static 'lk_files/total-img.svg' %}" alt="">
    <div class="total__header-content">
     <div class="total__company-name">
      ООО «ПКФ «Метинвест-сервис»
     </div>
     <div class="total__header-text">
      109428, г. Москва, Рязанский пр-т, д.10, стр.18, ком. А1.1
     </div>
     <div class="total__header-text">
      ИНН: 7721452768 КПП: 772101001
     </div>
     <div class="total__header-text">Тел. +7 495 230-70-33</div>
     <div class="total__header-text">
      E-mail: zakaz@pkf.ru Wev: pkf.ru
     </div>
    </div>
   </div>
   <div class="total__content">
    <div class="total__title">
     Коммерческое предложение № 10807 от 05 мая 2020 г.
    </div>
    <div class="total__line"></div>
    <div class="total__participants">
     <div class="total__participant">
      <div class="total__participant-name">Поставщик:</div>
      <div class="total__participant-value">
       ООО “ПКФ “Метинвест-сервис”, ИНН 7721452768, КПП 772101001, 109428, г. Москва, Рязанский пр-т, д.10, стр.18, ком. А1.1, тел.: 8 (495) 272-07-55
      </div>
     </div>
     <div class="total__participant">
      <div class="total__participant-name">Покупатель:</div>
      <div class="total__participant-value">ООО "Сириус"</div>
     </div>
    </div>
    <table class="total__table">
     <tbody id="total_table">
     <tr class="total__table-row">
      <th class="total__table-th">№</th>
      <th class="total__table-th">Товары (работы, услуги)</th>
      <th class="total__table-th">Кол-во</th>
      <th class="total__table-th">Ед.</th>
      <th class="total__table-th">Цена</th>
      <th class="total__table-th">Сумма</th>
     </tr>
     <tr class="total__table-row">
      <td class="total__table-td number">1</td>
      <td class="total__table-td">
       Арматура А3 А400 25Г2С 10 мм рифленая
      </td>
      <td class="total__table-td">5.3</td>
      <td class="total__table-td">тн</td>
      <td class="total__table-td price">34 510,00</td>
      <td class="total__table-td sum">179 670,00</td>
     </tr>
     <tr class="total__table-row">
      <td class="total__table-td number">2</td>
      <td class="total__table-td">
       Арматура А3 А400 35ГС 10 мм бухты
      </td>
      <td class="total__table-td">2</td>
      <td class="total__table-td">тн</td>
      <td class="total__table-td price">34 510,00</td>
      <td class="total__table-td sum">89 769,00</td>
     </tr>
     <tr class="total__table-row">
      <td class="total__table-td number">3</td>
      <td class="total__table-td">
       Труба профильная квадратная 90х90х5 ст. 3 12 м
      </td>
      <td class="total__table-td">1.2</td>
      <td class="total__table-td">тн</td>
      <td class="total__table-td price">33 490,00</td>
      <td class="total__table-td sum">65 490,00</td>
     </tr>
     </tbody>
    </table>
    <div class="total__sum">
     <div class="total__sum-item">
      <div class="total__sum-name">Итого</div>
      <div class="total__sum-value">2 078 731,00</div>
     </div>
     <div class="total__sum-item">
      <div class="total__sum-name">В том числе НДС</div>
      <div class="total__sum-value">346 455,16</div>
     </div>
     <div class="total__sum-item">
      <div class="total__sum-name">Всего к оплате</div>
      <div class="total__sum-value">2 078 731,00</div>
     </div>
    </div>
    <div class="total__footer-text">
     <p>Всего наименование 18, на сумму 2 078 731,00 руб.</p>
     <p>
      Два миллиона семьдесят восемь тысяч семьсот тридцать один рубль 00 копеек </p>
    </div>
    <div class="total__line"></div>
    <img class="signature" src="{% static 'lk_files/signature.png' %}" alt="">
   </div>
  </div>
 </div>
</div>

<hr style="margin-bottom: 40px">


<script src="lk_files/bootstrap.bundle.min.js"></script>
<script src="{% static 'lk_files/jquery.min.js' %}"></script>
<script src="{% static 'lk_files/clipboard.min.js' %}"></script>
<script src="{% static 'lk_files/dashboard.js' %}"></script>
</body>
</html>

<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script
   src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script><!--    <script>--><!--    $(document).ready(function() {--><!--      $("#search-input").autocomplete({--><!--        source: function(request, response) {--><!--          $.ajax({--><!--            url: "/search_auto_product/",--><!--            type: "POST",--><!--            dataType: "json",--><!--            data: {--><!--              query: request.term--><!--            },--><!--            success: function(data) {--><!--              response(data.suggestions);--><!--            },--><!--            error: function(xhr, status, error) {--><!--              console.error("Ошибка запроса к серверу ElasticSearch: " + error);--><!--            }--><!--          });--><!--        },--><!--        minLength: 2--><!--      });--><!--    });--><!--    </script>-->
<script>

    var positions = 0;

    function hideResults() {
      $("#product-results").empty();
      $("#category-results").empty();

      $('.search-data').hide();
      $('.not-search-data').show();

    }

    function showResults() {
      $('.search-data').show();
      $('.not-search-data').hide();
    }

    function deletePosition(position) {
      $('#position' + position).remove();
      refreshDocument();
    }

    function addSelectedProduct(productName, price) {
      if (price === undefined) {
        price = '';
      }
      positions = positions + 1;

      $('#selected_products tr:last')
        .before('<tr id="position' + positions + '">' +
            '<td><input class="input_watch" type="text" value="' + productName + '"/></td>' +
            '<td><input class="input_watch" type="text" value="' + price + '"/></td>' +
            '<td><input class="input_watch" type="text" placeholder="Кол-во"/></td>' +
            '<td><input class="input_watch" type="text" placeholder="Ед."/></td>' +
            '<td id="sum' + positions + '"></td>' +
            '<td><input class="input_watch" type="text" style="width: 100%" placeholder="Комментарий"></input></td>' +
            '<td style="cursor: pointer" onclick="deletePosition(' + positions + ')">' +
               '<img class="delete-icon" src="{% static 'lk_files/delete.svg' %}" alt="">' +
               '<span class="delete-text">Удалить</span>' +
            '</td></tr>');

      $('.input_watch').keyup(function() {
             refreshDocument();
        });

      refreshDocument();

    }

  function refreshDocument() {
     var html = '<tr class="total__table-row">' +
      '<th class="total__table-th">№</th>' +
      '<th class="total__table-th">Товары (работы, услуги)</th>' +
      '<th class="total__table-th">Цена</th>' +
      '<th class="total__table-th">Кол-во</th>' +
      '<th class="total__table-th">Ед.</th>' +
      '<th class="total__table-th">Сумма</th>' +
     '</tr>';

     var num = 0;
     $('#selected_products tr').not(':first').not(':last').each(function(tr_index) {

       var trHtml = '<tr class="total__table-row">';

       num += 1;
       trHtml += '<td class="total__table-td">' + num + '</td>';

       $(this).find('td input').each(function(td_index) {
         trHtml += '<td class="total__table-td">' + $(this).val() + '</td>';
       });

       html += trHtml + '</tr>';

     });

     $('#total_table').html(html);
  }

    function addCheck(element) {
      //$(element).append('<img class="td-selected" src="https://prod.pkf-m.ru/static/images/positions/check.svg" alt="">');
      $(element).css('background-color', '#aaffaa');
    }

    /*
    $(document).ready(function () {
refreshDocument();
        var $searchInput = $("#search-input");
        var $productResults = $("#product-results");
        var $categoryResults = $("#category-results");

        $("#search-input").on("blur", function() {
            hideResults();
        });

        $productResults.on("click", ".result", function() {
            var suggestion = $(this).find(".name").text();
            $searchInput.val(suggestion);
        });


        $categoryResults.on("click", ".result", function() {
            var suggestion = $(this).find(".name").text();
            $searchInput.val(suggestion);
        });

        $("#search-input").autocomplete({
            source: function(request, response) {
                $.ajax({
                    url: "/search_auto_product/",
                    type: "POST",
                    dataType: "json",
                    data: {
                        query: request.term
                    },
                    success: function(data) {
                        showResults();
                        displayResults(data.suggestions, $productResults, 'Поиск по продуктам');
                    },
                    error: function(xhr, status, error) {
                        console.error("Ошибка запроса к серверу для товаров: " + error);
                    }
                });

                $.ajax({
                    url: "/search_auto_section/",
                    type: "POST",
                    dataType: "json",
                    data: {
                        query: request.term
                    },
                    success: function(data) {
                        displayResults(data.suggestions, $categoryResults, 'Поиск по категориям');
                    },
                    error: function(xhr, status, error) {
                        console.error("Ошибка запроса к серверу для категорий: " + error);
                    }
                });
            },
            minLength: 2
        });

        function displayResults(results, $container, title) {
            $container.empty();


            var titleHtml = '<div class="result-title">' + title + '</div>';

            $container.append(titleHtml);

            $.each(results, function(index, item) {

                var parts = item.split(",parser: ");
                var name = parts[0];
                var description = parts[1] || '';

                var resultHtml = '<div class="result"><div class="name">' + name + '</div><div class="description">' + description + '</div></div>';

                $container.append(resultHtml);
            });
        }
    });
    */

        var data; // Глобальная переменная для хранения данных
        var currentPage = 1; // Изначально текущая страница - 1
        var query;
        var timeout;

        function loadTableWithQuery(query, page, limit, offset) {

                $('.products__table thead tr').remove();
                $('.products__table tbody').empty();

                $('#products_table tbody').append('<tr><td style="text-align: center">Подождите</td></tr>');
                $('#categories_table tbody').append('<tr><td style="text-align: center">Подождите</td></tr>');

                var username = 'metinvest';
                var password = 'metall';

                $.ajax({
                    type: 'POST',
                    url: '/search/',
                    data: {
                        query: query,
                        username: username,
                        password: password,
                        page: page,
                        limit: limit,
                        offset: offset
                    },
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader("Authorization", "Basic " + btoa(username + ":" + password));
                    },
                    success: function(responseData) {
                        data = responseData;

                        $('.products__table thead tr').remove();
                        $('.products__table tbody').empty();

                        if (data.products) {
                            var headerRow = $('<tr>');

                              var categoryHeader = $('<th>').text('Категория');
                              headerRow.append(categoryHeader);
                              var nameHeader = $('<th>').text('Наименование');
                              headerRow.append(nameHeader);
                              var characteristicsHeader = $('<th>').text('Характеристики');
                              headerRow.append(characteristicsHeader);
                              var cityHeader = $('<th>').text('Город');
                              headerRow.append(cityHeader);
                              var supplierHeader = $('<th>').text('Поставщик');
                              headerRow.append(supplierHeader);
                              var priceHeader = $('<th>').html('Цена');
                              headerRow.append(priceHeader);
                              var updatedHeader = $('<th>').text('Обновлено');
                              headerRow.append(updatedHeader);

                            $('#products_table thead').append(headerRow);

                            var products = data.products;
                            for (var i = 0; i < products.length; i++) {
                                var productCategory = products[i].category.name;
                                var productName = products[i].name;
                                var productData = products[i].data;
                                var productCity = products[i].city;
                                var productSupplier = products[i].supplier.name + '   (' + products[i].supplier.parser + ')';
                                var productPrice = products[i].price.replace(',', ' ').replace('<br/>', '; ');
                                var productUpdated = products[i].updated;

                                var newRow = $('<tr  style="background-color: #ffffff" class="hover_price" style="cursor: pointer" onclick="addCheck(this);addSelectedProduct(\'' + productName + '\', ' + productPrice + ')">');
                                var categoryCell = $('<td>').html(productCategory);
                                var nameCell = $('<td>').html('<div font-size: 18px>' + productName + '</div>');
                                var productHtml = '';
                                for (var d = 0; d < Object.keys(productData).length; d++) {
                                  if (productData[Object.keys(productData)[d]] != '') {
                                    productHtml += '<b>' + Object.keys(productData)[d] + '</b>:  ' + productData[Object.keys(productData)[d]] + '<br/>'
                                  }
                                }
                                var dataCell = $('<td>').html(productHtml);
                                var cityCell = $('<td>').html(productCity);
                                var supplierCell = $('<td>').html(productSupplier);
                                var priceCell = $('<td>').text(productPrice);
                                var updatedCell = $('<td>').text(productUpdated);

                                newRow.append(categoryCell);
                                newRow.append(nameCell);
                                newRow.append(dataCell);
                                newRow.append(cityCell);
                                newRow.append(supplierCell);
                                newRow.append(priceCell);
                                newRow.append(updatedCell);

                                $('#products_table tbody').append(newRow);
                            }
                        } else {
                            console.log('Нет данных о продуктах или данные пусты');
                        }

                        if (data.unique_sections) {

                            var uniqueSections = data.unique_sections;
                            for (var i = 0; i < uniqueSections.length; i++) {
                                var uniqueSection = uniqueSections[i];

                                var newRow = $('<tr style="background-color: #ffffff">');
                                var nameCell = $('<td>').text(uniqueSection);

                                newRow.prepend(nameCell);

                                $('#categories_table tbody').append(newRow);
                            }
                        } else {
                            console.log('Нет данных о продуктах или данные пусты');
                        }

                    },

                    error: function(xhr, textStatus, errorThrown) {
                        console.error('Ошибка при выполнении запроса:', errorThrown);
                    }
                });
            }

            function updateTableForPage(page) {
                    query = $('#search-input').val();
                    var limit = $('#limit').val();
                    var offset = $('#offset').val();
                    if (query === '') {
                        query = 'Арматура';
                    }
                    loadTableWithQuery(query, page, limit, offset);
                    $('#current-page').text('Страница ' + currentPage);
            }

    $(document).ready(function() {
      $("#search-input").autocomplete({
        source: function(request, response) {
          $.ajax({
            url: "/search/",
            type: "POST",
            dataType: "json",
            data: {
              query: request.term
            },
            success: function(data) {
              showResults();
              response(data.suggestions);
              updateTableForPage();
            },
            error: function(xhr, status, error) {
              console.error("Ошибка запроса к серверу ElasticSearch: " + error);
            }
          });
        },
        select: function( event, ui ) {
          clearTimeout(timeout);
          timeout = setTimeout(function() {
             updateTableForPage();
          }, 100);
        },
        minLength: 2
      });
    });

        $(document).ready(function() {

             /*
             $('#search-button').click(function(e) {
                e.preventDefault();
                var query = $('#search-input').val();

                var limit = $('#limit').val();
                var offset = $('#offset').val();

                loadTableWithQuery(query, currentPage , limit, offset);
            });
            */

            $('#prev-page').click(function(e) {
                e.preventDefault();
                if (currentPage > 1) {
                    currentPage--;
                    updateTableForPage(currentPage);
                }
            });

            $('#next-page').click(function(e) {
                e.preventDefault();
                console.log(data.total_count.value)

                //if (currentPage < data.total_count.value) {
                    currentPage++;
                    updateTableForPage(currentPage, query);
                //}
            });

            if ($('#search-input').val() === '') {
              loadTableWithQuery();
            }
        });

    </script>
